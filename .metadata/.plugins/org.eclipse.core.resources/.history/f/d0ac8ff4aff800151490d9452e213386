import java.io.*; 
import java.net.*;
import java.sql.ResultSet;
import java.sql.ResultSetMetaData; 
class UDPServer
{    
	public static void main(String args[]) throws Exception       
	{          
		DBConnect db = new DBConnect();
		DatagramSocket serverSocket = new DatagramSocket(9876);
		byte[] receiveData = new byte[1024];
		byte[] sendData = new byte[1024];
		while(true)                
		{
			//Creates a socket for receiving packets
			DatagramPacket receivePacket = new DatagramPacket(receiveData, receiveData.length);    
			
			//Created socket receives packet
			
			serverSocket.receive(receivePacket);                   
			String queryFromClient = new String( receivePacket.getData());                   
			
			ResultSet resultSet = db.executeQuery(queryFromClient);

			
			ResultSetMetaData rsmd = resultSet.getMetaData();
			
			int columnsNumber = rsmd.getColumnCount();
			
			
			while (resultSet.next()) {
			    for (int i = 1; i <= columnsNumber; i++) {
			        if (i > 1) System.out.print(",  ");
			        String columnValue = resultSet.getString(i);
			        System.out.print(columnValue + " " + rsmd.getColumnName(i));
			    }
			    System.out.println("");
			}
			
			//Using received packet I get address and port number
			InetAddress IPAddress = receivePacket.getAddress();                   
			int port = receivePacket.getPort();                   
			
			//Send back sentence as acknowledgement/reply
			String sendBackHandshake = "I accepted handshake";                  
			
			sendData = sendBackHandshake.getBytes();     
			   
			
			
			//gives back the result to client
			String result = Integer.toString(count);
			
			sendData = result.getBytes();
			
			
			DatagramPacket returnResult = new DatagramPacket(sendData, sendData.length, IPAddress, port);
			serverSocket.send(returnResult); 
			
		}       
	} 
}